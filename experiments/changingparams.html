<html>
<head>
  <title>Changing Parameters Experiment</title>
</head>
<body>
<h1>Changing Parameters Experiment</h1>
<div>Status: <span id="status"></span></div>
<button id="play">Play</button>
<button id="stop">Stop</button>
<input type="text" id="offset" size="5" value="0">
<script src="bufferloader.js"></script>
<script>
  var audioContext = new (AudioContext || webkitAudioContext)();
  var buffer, gain = audioContext.createGain(), bufferSourceNode;
  var st = document.getElementById('status'), time = document.getElementById('time');

  gain.gain.value = 1.0;
  gain.connect(audioContext.destination);

  loadBuffer(audioContext, '../sounds/bg.mp3', function (b) {
    buffer = b;
    st.innerText = "Ready";
  });

  document.getElementById('play').addEventListener('click', function () {
    bufferSourceNode = audioContext.createBufferSource();
    bufferSourceNode.buffer = buffer;
    var offset = document.getElementById('offset').value;
    //bufferSourceNode.start(audioContext.currentTime + parseFloat(offset), 5, 10);
    bufferSourceNode.start(0);
    bufferSourceNode.connect(gain);
  });

  document.getElementById('stop').addEventListener('click', function () {
    gain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 3);
    //bufferSourceNode.stop(3);
    //bufferSourceNode.disconnect();
    //bufferSourceNode = null;
  });
</script>
</body>
</html>
